<title></title>
<script>
  let interval;

  // Get a dropdown value by its html id
  function getValue(id) {
    const element = document.getElementById(id);
    return Number(element.options[element.selectedIndex].value);
  }

  // Set the time on the clock (in seconds)
  function setTime(time) {
    const date = new Date(time * 1000);
    const timeString = `${String(date.getUTCMinutes()).padStart(2, "0")}:${String(date.getUTCSeconds()).padStart(2, "0")}`; 

    document.title = timeString; 
    document.getElementById("time").innerHTML = timeString; 
  }

  // Set the message to display
  function setMessage(message) {
    document.getElementById('message').innerHTML = message;
  }

  // Start the timer
  function start() {
    const begin = Math.floor(Date.now() / 1000);
    let end = begin;
    const reps = 4;
    const sets = getValue('sets');
    const rest = getValue('rest');

    function getReady() {
      end += 5;
      setMessage('Get Ready...');
    }

    function rep() {
      end += 10;
      setMessage('Hang!');
    }

    function repRest() {
      end += rest;
      setMessage('Rest');
    }

    function setRest() {
      end += 120;
      setMessage('Take a short break');
    }

    function terminate() {
      setMessage('Done');
      stop();
    }

    function* set() {
      yield rep;
      for (let r=1; r<reps; r++) {
        yield repRest;
        yield rep;
      }
    }

    function* workout() {
      yield getReady;
      for (let event of set()) {
        yield event;
      }
      for (let s=1; s<sets; s++) {
        yield setRest;
        for (let event of set()) {
          yield event;
        }
      }
    }

    // start the next phase of the workout
    const next = (() => {
      const w = workout();
      let current = w.next();
      return () => {
        if (current.done) {
          terminate();
        } else {
          (current.value)();
          current = w.next();
        }
      }
    })();

    // Calculate time to display (in seconds)
    function getTimeRemaining() {
      const now = Math.floor(Date.now() / 1000);
      const timePassed = now - begin;
      return end - timePassed - begin;
    }

    function update() {
      let timeRemaining = getTimeRemaining();
      if (timeRemaining < 1) {
        next();
        timeRemaining = getTimeRemaining();
      }

      setTime(timeRemaining);
    }

    next();
    update();
    interval = setInterval(update, 1000);
  }

  // Stop the workout
  function stop() {
    clearInterval(interval);
  }
</script>
<style>
  body {
    background-color: black
  }
  button, select {
    background-color: black;
    color: white;
    border: 2px solid white;
    border-radius: 5px;
    font-size: 5em;
  }
  label, span {
    font-size: 5em;
  }
  .main {
    color:white;
    position:absolute;
    top:50%;
    left:0;
    width:100%;
    text-align:center;
    margin-top:-200px;
  }
</style>
<div class="main">
  <h1 id="time" style="font-size:10em;margin:0">00:00</h1>
  <h3 id="message" style="font-size:5em;margin:0">Press Start</h3>
  <p>
    <button onclick="start()">Start</button><span>&nbsp;</span><button onclick="stop()">Stop</button>
  </p>
  <p>
    <label>
      Rest:
    </label>
    <select id="rest">
      <option value="30">30s</option>
      <option value="20">20s</option>
    </select>
    <span>&nbsp</span>
    <label>
      Sets:
    </label>
    <select id="sets">
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
    </select>
  </p>
</div>